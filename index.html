<!DOCTYPE html>
<html lang="de">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Tower</title>
    </head>
    <body>
        <main>
            <div>
                <span> Dr√ºcke den Start-Knopf (ENTER), um zu starten.</span>
                <a style="display: none" href="/tower/game/hate_speech.html">x</a>
                <a style="display: none" href="/tower/game/unknown_language.html">x</a>
            </div>
        </main>

        <script type="module">
            import { setupInputBackend, spoofInputBackend } from "./src/lib/control/control.js";
            import { initAfterLoad } from "./src/lib/init.js";
            import { infoButton } from "./src/lib/meta/infoButton.js";
            import { showModal } from "./src/lib/meta/modal.js";

            function onInput({ detail }) {
                const button = detail.button;
                console.log("btn", button);

                if (button === "buttonStart") {
                    const urlParams = new URLSearchParams(window.location.search);
                    const gameId = urlParams.get("game");
                    if (gameId) {
                        document.querySelector("a").href = `/tower/game/${gameId}.html`;
                    }

                    document.querySelector("a").click();
                }
            }

            initAfterLoad(() => {
                setupInputBackend();

                // spoof input
                document.addEventListener("keydown", (event) => {
                    if (event.key === "Enter") {
                        spoofInputBackend(1, "buttonStart");
                    }
                });

                // listen
                document.addEventListener("input:game1", onInput);
            });
        </script>
    </body>
</html>
